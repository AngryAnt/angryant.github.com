<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
	<head>
		<title>AngryAnt - CoreObject - </title>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="/css/screen/base.css" type="text/css" media="screen" />
<link rel="stylesheet" href="/css/screen/site.css" type="text/css" media="screen" />
<link rel="stylesheet" href="/css/print/base.css" type="text/css" media="print" />
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34029666-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


		<link rel="author" href="https://plus.google.com/+EmilJohansen" />
	</head>
	<body>
		<div id="site">
			<div id="sidebar">
				<img id="logo" title="Logo" alt="Logo" src="/resources/logo.png">
<h1 class="header"><a href="/" style="padding:0; margin:0; float: none;">AngryAnt</a></h1>
<div id="subtitle">CoreObject</div>

	
		<a href="/">Home</a>
		
	

	
		<a href="/freelance">Freelance</a>
		
	

	
		<a href="/behave">Behave</a>
		
	

	
		<a href="/tools">Tools</a>
		
	

	
		<a href="/feed">Feed</a>
		
	

	
		<a href="/videos">Videos</a>
		
	


<div id="external">
	<a href="/feed.xml">RSS</a>
	<a href="/feed.articles.xml">Full RSS</a>
	<a href="https://gist.github.com/AngryAnt">Gist</a>
	<a href="https://twitter.com/AngryAnt">Twitter</a>
	<a href="http://eej.dk">LinkedIn</a>
	<a href="http://lanyrd.eej.dk">Lanyrd</a>
	<a href="http://connect.eej.dk">Unity Connect</a>
</div>

			</div>
			<div id="container">
				<span class="date">04 Jul 2017</span>
				<h1 id="Top">CoreObject</h1>
				
				<div id="content">
					<div class="post"><p>I once built a talk with a collection of new hacks. This talk went through a couple of almost-delivered scenarios and with the <a href="http://GameAINorth.com">new side projects</a> I have since accumulated, scheduling gets difficult.</p>
<p>So I would rather share this stuff in post form now than stall for a possible eventuality. I have no idea how frequent I will be able to post, but here is one at least.</p>
<h2>Challenge</h2>
<p>Most Unity projects get spread across multiple scenes very quickly. This is advantageous not only for clearly segmented production, but also for tweaking of load times, streaming, and much more.</p>
<p>An unfortunate side effect of this is increased challenges in referencing objects in a live session, across these scenes. This can be objects baked into specific scenes or specific instances created at runtime.</p>
<p>Common approaches to solving this include dependency injection and directory singletons &#8211; both of which work really great. Unfortunately they both introduce a level of indirection in the Unity serialisation system, making it impossible to track cross-scene dependencies with generic tools. This also usually adds a programming- or finicky book-keeping step to the process of introducing new conceptual instances.</p>
<p>If we could solve this challenge, we would end up with a clear dependency chain in the serialisation system, which would allow us to fully utilise the tracking and tooling benefits this yields, while greatly reducing the barrier to add new concepts and interact with existing ones.</p>
<h2>Detour</h2>
<p>With each scene a serialised island, there is one more (ignoring bundles) serialisation hub which all scenes can access: Assets.</p>
<p>Both the instance and its consumer can reference the same asset, which we can then use to facilitate a connection between the two. Further, with both referencing the same asset, we now have that dependency information in the serialisation system and adding new conceptual instances is just a matter of creating a new asset and assign it to either end.</p>
<p>Another bonus is easy listing of all conceptual instances (simply finding all assets of the type), which is easiest demonstrated through the object picker. Should you prefer a drop-down selector to the object picker, that is a fairly straight forward piece of property drawer code &#8211; in which you could even utilise asset folder structure to define drop-down nesting.</p>
<h2>Implementation</h2>
<p>The base (5.3 tested) implementation of this needs three pieces:</p>
<ul>
	<li>A <code>ScriptableObject</code> type representing the conceptual instance as an asset.
	<ul>
		<li><a href="https://gist.githubusercontent.com/AngryAnt/65b1289fe0af88c6e5fce7f3001bd0c8/raw/CoreObject.cs">Example abstract</a>, <a href="https://gist.githubusercontent.com/AngryAnt/65b1289fe0af88c6e5fce7f3001bd0c8/raw/CoreGameObject.cs">example concrete</a>.</li>
	</ul></li>
	<li>One <code>MonoBehaviour</code> registering a source.
	<ul>
		<li><a href="https://gist.githubusercontent.com/AngryAnt/65b1289fe0af88c6e5fce7f3001bd0c8/raw/CoreGameObjectInstance.cs">Example</a>.</li>
	</ul></li>
	<li>A serialized reference to the <code>ScriptableObject</code> type or a <code>MonoBehaviour</code> acting as a gateway to the instance &#8211; similar to a <code>MeshFilter</code> component.
	<ul>
		<li><a href="https://gist.githubusercontent.com/AngryAnt/65b1289fe0af88c6e5fce7f3001bd0c8/raw/Test.cs">Example</a>.</li>
	</ul></li>
</ul>
<p>In the given example, the instances being passed around are just <code>GameObjects</code>. However in a real world scenario you may also want to create <code>CoreObject&lt;T&gt;</code> derivatives passing references to specific components. Not only does this facilitate quicker access to the components you need &#8211; it also naturally separates <code>CoreObjects</code> into categories.</p>
<p>A corresponding instance component could look a little something like <a href="https://gist.githubusercontent.com/AngryAnt/65b1289fe0af88c6e5fce7f3001bd0c8/raw/CoreCharacterInstance.cs">this</a>.</p>
<h2>Variants</h2>
<p>While this base functionality has plenty of utility, I have on occasion played around with variants on the concept. For one, the base idea passes a single-source instance producer to multiple consumers, but there is no reason why you could not use this setup to register/unregister to a list of instances in stead.</p>
<p>A personal favourite variant is more fundamentally different. In stead of facilitating references, the core objects wrap <code>UnityEvents</code> &#8211; turning them into global &#8220;game events&#8221;. This allows you to completely decouple event producers and consumers, while maintaining dependency tracking through the serialisation system.</p>
<p>The pattern I mostly use such events in start with the producers invoking the event via a serialised <code>UnityEvent</code>. Say you expose a &#8220;fire&#8221; <code>UnityEvent</code> to which you add a particle effect invocation, audio playback, and finally the invocation of the <code>CoreGameEvent</code> &#8220;gunshot&#8221;.</p>
<p>This &#8220;gunshot&#8221; event would then be referenced by <code>CoreGameEventHandler</code> components which also exposes a &#8220;handle&#8221; <code>UnityEvent</code>. The action list of this event could then include stuff like switching the soundscape, putting NPCs into an alert state, trigger an auto save, and whatever else might be useful.</p>
<p>So what do you think? Do you use something similar? What cool variants and tooling do you employ?</p>
<ul>
	<li><a href="https://gist.github.com/AngryAnt/65b1289fe0af88c6e5fce7f3001bd0c8">Source and examples</a></li>
</ul>





</div>
				</div>
				<div id="feed-container">
					<div id="feed">
						
							<a href="/2017/07/04/CoreObject/" class="titleSmall">CoreObject</a><br />
						
							<a href="/2017/02/17/Unity-Protocol-Buffers/" class="titleSmall">Unity Protocol Buffers</a><br />
						
							<a href="/2016/02/13/Behave-2-7/" class="titleSmall">Behave 2.7</a><br />
						
							<a href="/2015/07/17/Learn/" class="titleSmall">Learn</a><br />
						
							<a href="/2015/06/13/Behave-2-6/" class="titleSmall">Behave 2.6</a><br />
						
							<a href="/2015/02/26/Trusted-Gear/" class="titleSmall">Trusted Gear</a><br />
						
							<a href="/2015/01/02/Mad-Mash-Versioning/" class="titleSmall">Mad Mash Versioning</a><br />
						
							<a href="/2015/01/01/Behave-2-5/" class="titleSmall">Behave 2.5</a><br />
						
							<a href="/2014/11/28/Behave-2-4/" class="titleSmall">Behave 2.4</a><br />
						
							<a href="/2014/06/20/Co-very-routine/" class="titleSmall">Co-very-routine</a><br />
						
							<a href="/2014/04/25/Construct/" class="titleSmall">Construct</a><br />
						
							<a href="/2014/03/25/The-Engine-Wars-Numbers/" class="titleSmall">The Engine Wars: Numbers</a><br />
						
							<a href="/2014/03/13/GDC-14-The-Quest-For-Fun/" class="titleSmall">GDC 14: The Quest For Fun</a><br />
						
							<a href="/2014/03/07/Moving-in-Unity/" class="titleSmall">Moving in Unity</a><br />
						
							<a href="/2014/02/27/Behave-2-3/" class="titleSmall">Behave 2.3</a><br />
						
							<a href="/2014/01/03/Unity-and-net-assemblies/" class="titleSmall">Unity and .net assemblies</a><br />
						
							<a href="/2013/12/23/Behave-2-2/" class="titleSmall">Behave 2.2</a><br />
						
							<a href="/2013/10/11/ReView/" class="titleSmall">ReView</a><br />
						
							<a href="/2013/10/06/Behave-2-1/" class="titleSmall">Behave 2.1</a><br />
						
							<a href="/2013/08/25/Behave-2-0/" class="titleSmall">Behave 2.0</a><br />
						
							<a href="/2013/08/04/Unity-Hacks-Dual-sticks/" class="titleSmall">Unity Hacks: Dual sticks</a><br />
						
							<a href="/2013/07/28/Unity-Hacks-Cameras/" class="titleSmall">Unity Hacks: Cameras</a><br />
						
							<a href="/2013/07/19/Unity-Hacks-Touch-gestures/" class="titleSmall">Unity Hacks: Touch gestures</a><br />
						
							<a href="/2013/07/17/OnRenderTextureGUI/" class="titleSmall">OnRenderTextureGUI</a><br />
						
							<a href="/2013/07/05/Unite-13-video-Unity-Hacks-available/" class="titleSmall">Unite 13 video "Unity Hacks" available</a><br />
						
							<a href="/2013/06/07/The-implicit-local-network-interface/" class="titleSmall">The implicit local network interface</a><br />
						
							<a href="/2013/05/21/Talks-and-progress/" class="titleSmall">Talks and progress</a><br />
						
							<a href="/2013/05/14/Five-years-of-Unity-expertise-looking-for-contracts/" class="titleSmall">Five years of Unity expertise looking for contracts</a><br />
						
							<a href="/2012/12/22/Automagic-Unity-Android-Java-gadget-OF-DOOM/" class="titleSmall">Automagic Unity Android Java gadget OF DOOM!</a><br />
						
							<a href="/2012/10/03/Invading-Planet-from-your-couch/" class="titleSmall">Invading Planet from your couch</a><br />
						
							<a href="/2012/09/28/Mountain-Lion-and-laggy-bluetooth-and-duct-tape/" class="titleSmall">Mountain Lion and laggy bluetooth and duct-tape</a><br />
						
							<a href="/2012/09/23/Unite-12-video-and-new-videos-section-available/" class="titleSmall">Unite 12 video and new videos section available</a><br />
						
							<a href="/2012/08/28/Asia-Bootcamp-videos-now-available/" class="titleSmall">Asia Bootcamp videos now available</a><br />
						
							<a href="/2012/05/17/path-is-now-mit-licensed/" class="titleSmall">Path is now MIT licensed</a><br />
						
							<a href="/2011/11/30/behave-1-4-released/" class="titleSmall">Behave 1.4 released</a><br />
						
							<a href="/2011/10/09/so-ive-been-a-bit-busy-lately/" class="titleSmall">So I've been a bit busy lately</a><br />
						
							<a href="/2011/04/28/behave-1-3-released/" class="titleSmall">Behave 1.3 released</a><br />
						
							<a href="/2011/04/23/igda-unity-sig-slides/" class="titleSmall">IGDA Unity SIG slides</a><br />
						
							<a href="/2011/03/17/second-unity-igda-sig-this-evening-scene-construction-and-ai/" class="titleSmall">Second Unity IGDA SIG this evening: Scene construction and AI</a><br />
						
							<a href="/2011/03/10/first-igda-unity-sig-this-evening/" class="titleSmall">First IGDA Unity SIG this evening</a><br />
						
							<a href="/2011/03/03/alternative-licensing-available/" class="titleSmall">Alternative licensing available</a><br />
						
							<a href="/2011/02/15/pathfinding-in-two-line/" class="titleSmall">Pathfinding in two lines</a><br />
						
							<a href="/2011/02/15/path-2-released/" class="titleSmall">Path 2 released</a><br />
						
							<a href="/2011/02/02/assembling-and-assimilating/" class="titleSmall">Assembling and assimilating</a><br />
						
							<a href="/2011/01/29/path-2-intro-screencast/" class="titleSmall">Path 2 intro screencast</a><br />
						
							<a href="/2011/01/29/path-2-beta-release-for-ggj/" class="titleSmall">Path 2 beta release for GGJ</a><br />
						
							<a href="/2011/01/25/aigamedev-master-class-video-now-online-3/" class="titleSmall">AIgameDev master class video now online</a><br />
						
							<a href="/2011/01/09/expanding-beta/" class="titleSmall">Expanding beta</a><br />
						
							<a href="/2010/11/28/behave-aigamedev-master-class-public-stream/" class="titleSmall">Behave AIgameDev master class public stream</a><br />
						
							<a href="/2010/11/27/behave-master-class-on-open-aigamedev-stream-tomorrow/" class="titleSmall">Behave master class on open AIgameDev stream tomorrow</a><br />
						
							<a href="/2010/10/29/interview-with-aigamedev/" class="titleSmall">Interview with AIGameDev</a><br />
						
							<a href="/2010/10/24/new-video-from-tree-to-code/" class="titleSmall">New video: From tree to code</a><br />
						
							<a href="/2010/10/23/issue-tracking-on-github-behave-release-project/" class="titleSmall">Issue tracking on github Behave release project</a><br />
						
							<a href="/2010/10/22/it-university-copenhagen-unity-course-completed/" class="titleSmall">IT University Copenhagen Unity course completed</a><br />
						
							<a href="/2010/10/21/it-university-copenhagen-unity-course-files-thursday/" class="titleSmall">IT University Copenhagen Unity course files Thursday</a><br />
						
							<a href="/2010/10/20/cph-it-university-unity-course-files/" class="titleSmall">CPH IT University Unity course files</a><br />
						
							<a href="/2010/10/11/behave-1-2-released/" class="titleSmall">Behave 1.2 released</a><br />
						
							<a href="/2010/09/29/video-behave-starting-from-scratch/" class="titleSmall">Video: Behave - starting from scratch</a><br />
						
							<a href="/2010/09/29/behave-runtime-documentation-updated/" class="titleSmall">Behave runtime documentation updated</a><br />
						
							<a href="/2010/09/29/behave-1-1-released/" class="titleSmall">Behave 1.1 released</a><br />
						
							<a href="/2010/03/19/faff-cleanup-sketch/" class="titleSmall">FAFF cleanup: Sketch</a><br />
						
							<a href="/2010/03/15/building-a-menu-of-delegates-and-enums/" class="titleSmall">Building a menu of delegates and enums</a><br />
						
							<a href="/2010/03/10/pick-me-pick-me/" class="titleSmall">Pick me! Pick me!</a><br />
						
							<a href="/2010/01/14/optimising-coroutine-yielding-in-c/" class="titleSmall">Optimising coroutine yielding in C#</a><br />
						
							<a href="/2010/01/05/downloading-the-hydra/" class="titleSmall">Downloading the hydra</a><br />
						
							<a href="/2009/11/15/new-license-of-path-gpl/" class="titleSmall">New license of Path: GPL</a><br />
						
							<a href="/2009/11/04/copyinspector/" class="titleSmall">CopyInspector</a><br />
						
							<a href="/2009/10/04/magnetic/" class="titleSmall">Magnetic</a><br />
						
							<a href="/2009/09/18/gui-drag-drop/" class="titleSmall">GUI drag-drop</a><br />
						
							<a href="/2009/09/17/logging-an-entire-gameobject/" class="titleSmall">Logging an entire GameObject</a><br />
						
							<a href="/2009/09/07/i-bet-you-cant-type-an-a/" class="titleSmall">I bet you can't type an A!</a><br />
						
							<a href="/2009/08/31/where-did-that-component-go/" class="titleSmall">Where did that component go?</a><br />
						
							<a href="/2009/08/19/unitysteer/" class="titleSmall">UnitySteer</a><br />
						
							<a href="/2009/05/18/new-and-improved-behave-10-released/" class="titleSmall">New and improved: Behave 1.0 released</a><br />
						
							<a href="/2009/04/08/behave-03b-and-unity-25/" class="titleSmall">Behave 0.3b and unity 2.5</a><br />
						
							<a href="/2009/03/20/behave-03b-hotfix/" class="titleSmall">Behave 0.3b hotfix</a><br />
						
							<a href="/2009/03/19/path-tutorial-video-available/" class="titleSmall">Path tutorial video available</a><br />
						
							<a href="/2009/03/18/path-10-launched/" class="titleSmall">Path 1.0 launched!</a><br />
						
							<a href="/2008/12/17/community-tutorial-2/" class="titleSmall">Continued community tutorials</a><br />
						
							<a href="/2008/11/30/community-tutorial/" class="titleSmall">Community tutorial</a><br />
						
							<a href="/2008/11/28/new-tutorial/" class="titleSmall">New tutorial</a><br />
						
							<a href="/2008/11/04/first-tutorial-available/" class="titleSmall">First tutorial available</a><br />
						
							<a href="/2008/11/02/behave-03b/" class="titleSmall">Behave 0.3b</a><br />
						
							<a href="/2008/10/25/unite-08-open-mic-session/" class="titleSmall">unite '08 open-mic session</a><br />
						
							<a href="/2008/09/24/behave-02b/" class="titleSmall">Behave 0.2b</a><br />
						
							<a href="/2008/09/09/behave-01b/" class="titleSmall">Behave 0.1b</a><br />
						
							<a href="/2008/09/08/behave-pre-release/" class="titleSmall">Behave pre-release</a><br />
						
							<a href="/2008/04/15/path-beta-03b/" class="titleSmall">Path beta 0.3b</a><br />
						
							<a href="/2008/04/12/path-beta-02b/" class="titleSmall">Path beta 0.2b</a><br />
						
							<a href="/2008/04/05/path-beta-01b/" class="titleSmall">Path beta 0.1b</a><br />
						
							<a href="/2008/03/30/path-pre-release/" class="titleSmall">Path pre-release</a><br />
						
					</div>
				</div>
				<div id="footer">
	<p class="footnote" style="margin-top: 50px; margin-bottom: 10px; clear: both;">Copyright &#169; AngryAnt&trade; <script>document.write ((new Date ()).getFullYear ());</script>. All public github gists are public domain.</p>
	<script>document.write ('<img src="/resources/footers/' + Math.floor (Math.random () * 23 + 1) + '.png" width="600" height="300" class="noprint" style="margin-bottom: -5px;">');</script>
</div>

			</div>
		</div>
		

	</body>
</html>
