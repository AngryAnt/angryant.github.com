<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
	<head>
		<title>AngryAnt - Unity and .net assemblies - </title>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="/css/screen/base.css" type="text/css" media="screen" />
<link rel="stylesheet" href="/css/screen/site.css" type="text/css" media="screen" />
<link rel="stylesheet" href="/css/print/base.css" type="text/css" media="print" />
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34029666-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


		<link rel="author" href="https://plus.google.com/+EmilJohansen" />
	</head>
	<body>
		<div id="site">
			<div id="sidebar">
				<img id="logo" title="Logo" alt="Logo" src="/resources/logo.png">
<h1 class="header"><a href="/" style="padding:0; margin:0; float: none;">AngryAnt</a></h1>
<div id="subtitle">Unity and .net assemblies</div>

	
		<a href="/">Home</a>
		
	

	
		<a href="/freelance">Freelance</a>
		
	

	
		<a href="/behave">Behave</a>
		
	

	
		<a href="/tools">Tools</a>
		
	

	
		<a href="/feed">Feed</a>
		
	

	
		<a href="/videos">Videos</a>
		
	


<div id="external">
	<a href="/feed.xml">RSS</a>
	<a href="/feed.articles.xml">Full RSS</a>
	<a href="https://gist.github.com/AngryAnt">Gist</a>
	<a href="https://twitter.com/AngryAnt">Twitter</a>
	<a href="http://www.linkedin.com/in/EmilJohansen">LinkedIn</a>
	<a href="http://lanyrd.com/profile/angryant/">Lanyrd</a>
</div>

			</div>
			<div id="container">
				<span class="date">03 Jan 2014</span>
				<h1 id="Top">Unity and .net assemblies</h1>
				
				<div id="content">
					<div class="post"><p>Since I started making middleware for Unity in early 2008, I have been working with Unity and .net assemblies. I have in this time had many opportunities to juggle the two in many different contexts, so I figured a sort of summary of what I learned would make sense.</p>
<p>Why not start off by setting a few facts straight, eh?</p>
<ul>
	<li>Aside from the extension and a header, .net assemblies have little to do with Windows Dynamic Link Libraries.
	<ul>
		<li>Windows DLLs contain binary code, usually with a very simple interface, while .net assemblies contain .net bytecode (or <span class="caps">CIL</span>).</li>
	</ul></li>
	<li>Unity pro is not required to use .net assemblies.
	<ul>
		<li>Binary plugins require Unity pro (at time of writing) and must be placed in Assets/Plugins. However .net assemblies are just bytecode &#8211; just like what Unity turns your scripts into, so none of these requirements apply.</li>
	</ul></li>
	<li>.net assemblies run on all platforms &#8211; including webplayer.
	<ul>
		<li>Again, as we are talking about bytecode which is fed directly to the mono runtime &#8211; like the compiled result of your scripts, the same rules go.</li>
	</ul></li>
	<li>Distributing .net assemblies in stead of script files does not copy protect your code.
	<ul>
		<li>Since the mono runtime has to Just In Time compile your assembly to run on the current platform, the bytecode is quite verbose and while some information is lost, generally it is very easy to decompile and read .net assemblies.</li>
		<li>Remember that this is true for your script source in most project builds as well, since for most platforms Unity builds your scripts to .net assemblies.</li>
	</ul></li>
</ul>
<h1>Argh! But my kodes!</h1>
<p>I will not get into source protection too much, but generally I would not worry too much about it.</p>
<p>Source code in and of itself does not mean that someone can instantly copy and use parts of your work. It takes actual skill and time investment to make use of it, integrated in a different setup from what it was originally designed for. In the end it is my opinion that it would not be worth it compared to doing the same work from scratch.</p>
<p>Consider that the entire source of Half Life 2 was very publicly leaked shortly before its originally scheduled release and how we are all now drowning in games based on it.</p>
<p>If you have client-side security measures which you would like to protect &#8211; like in-app purchases or other anti-cheat measures, you may indeed want to consider splitting out and encrypting part of this logic as well as applying some measure of source obfuscation.</p>
<p>A word of caution: While source-level obfuscation is fine and usually sufficient, assembly-level obfuscation can be risky as it generally relies on bugs in the mono runtime in order to function. Bugs which might get fixed at any time &#8211; at which point you will need to go back and revisit your security efforts.</p>
<p>And remember: Encryption and obfuscation is just about making it harder for people to do things you don&#8217;t want them to. In the end this all has to be understood by processors and even binaries are routinely reverse engineered. The best security is gained by not making what you wish to protect available outside of hardware in your control.</p>
<p>For more information on protecting sensitive client-side information from tampering, see the Unite Asia 2013 &#8220;Protecting Your Android Content&#8221; talk by Erik Hemming.</p>
<p>Note that Unity does not distribute .net assemblies on all platforms. Some platforms do not run the mono <span class="caps">JIT</span> compiler because reasons and for those Unity will in stead perform Ahead Of Time compilation on your code while building.</p>
<p><span class="caps">AOT</span> compilation basically means that in stead of relying on the <span class="caps">JIT</span> compiler to at runtime load your bytecode when relevant and compile it for the specific hardware it is running on, the <span class="caps">AOT</span> compiler will compile all your assembly to platform-specific binary right up front.</p>
<p>This means that your source code assemblies, any assemblies present in your project as well as the Unity engine assemblies are all jumbled into one binary. In most cases this should disincentivise tampering sufficiently.</p>
<p>At time of writing, Unity employs <span class="caps">AOT</span> compiling on iOS and the console platforms.</p>
<h1>What is the point then?</h1>
<p>Now that you know what assemblies are not, you might be wondering why you should be interested in them at all. And rightly so.</p>
<p>I think it is always healthy to have some understanding of what goes on in the lower layers of your technology stack, but most Unity developers will not need to know about .net assemblies.</p>
<p>However here are some reasons why they are really cool:</p>
<ul>
	<li>If you are distributing middleware, they allow you to significantly reduce your distribution footprint without compromising your development environment (one assembly vs. a bunch of script files).
	<ul>
		<li>Like their Windows cousins, .net assemblies allow embedded resources, which means you can literally put everything you need &#8211; textures, audio, whatever &#8211; inside one file.</li>
	</ul></li>
	<li>Where <span class="caps">JIT</span> is available, new assembly can be loaded at runtime.
	<ul>
		<li>So what? So live patching baby!</li>
	</ul></li>
</ul>
<p>Since the <span class="caps">JIT</span> compiler routinely loads bytecode from disk and compiles and executes it, there is nothing preventing you from having it load bytecode which was not included in your original build.</p>
<p>The class System.Reflection.Assembly lets you load in bytecode from a file or a byte array, after which you can use reflection to find and instantiate types, call functions and all that other good stuff on what is contained in the assembly.</p>
<p>Remember that since Unity employs <span class="caps">AOT</span> and not <span class="caps">JIT</span> on some platforms, this functionality is not available everywhere.</p>
<p>For an example of loading in new assembly, see the code-in-asset-bundles example from the &#8220;Unity Hacks&#8221; talk available on the <a href="/videos">videos</a> page (source included).</p>
<p>A word of caution: If you plan on employing remote patching, make sure to at least sign your transfers in order to avoid man in the middle injection attacks.</p>
<h1>Wohoo! Assemble all of the things!</h1>
<p>This is all great, but how do you get started building assemblies for all them things? Well, dear reader, there are different approaches:</p>
<ul>
	<li>If you are already set up with Visual Studio or Mono Develop, you can simply create a new project for a .net assembly using the project creation wizard. In order to access Unity types, simply add the UnityEngine.dll (and if necessary the UnityEditor.dll) assemblies to the project references and off you go.</li>
	<li>Should you be of a different persuasion and if you are not one to shy away from a terminal window, you can use the the gmcs binary as distributed with Unity or the mono <span class="caps">SDK</span> to build your assembly by command-line.</li>
</ul>
<p>Either of these will produce a .dll file with all of your kodes (and potentially resources). Simply drop it anywhere in your assets folder to gain access to the contained classes. The same compile order rules which apply to scripts, also hold true for assemblies.</p>
<p>Any public ScriptableObject or MonoBehaviour derived classes will appear as children of the assembly asset. Simply click the folding widget next to the asset in order to view and be able to drag-drop them.</p>
<p>Ah and if you were too lazy to check out the Unity Hacks talk (you really should, it is full of useful snippets), the trick for putting code in asset bundles is to compile the scripts to an assembly rather than letting Unity compile them and then save the assembly in your assets folder with the .bytes extension rather than .dll.</p>
<p>This makes Unity import the assembly as a TextAsset which is not addressed by Unitys compiler and can be included in asset bundles. At runtime, the bytes property of the asset reference is then passed to the Assembly constructor as described earlier.</p>
<h1>And the catch?</h1>
<p>Given that we are reaching the end of this article, that would mean it is high time for some dream bursting. This all sounds very easy and optimal to work with, but of-course it is not that simple.</p>
<p>While Unity makes it fairly straight forward to debug your scripts using MonoDevelop, it will by default do absolutely nothing to help you with your assemblies.</p>
<p>To help it on its way, you need to first build your assemblies for debug and secondly copy the generated [AssemblyName].mdb file to your assets folder along side the .dll file.</p>
<p>If you went ahead and looked for the mdb file right as I had ended the above paragraph, you would stand some chance of not finding it. Should you be on Windows, a pdb file rather than an mdb is generated and it is absolutely useless to the Unity debugging runtime.</p>
<p>Should you be stuck with a pdb file, you will need to use the pdb2mdb command-line tool as distributed with the Unity mono runtime or the mono <span class="caps">SDK</span>. However running this command by hand every time you need to debug gets old really fast, so I recommend adding it in as a post-build step on your MonoDevelop or VisualStudio project.</p>
<p>For more information on debugging assemblies in Unity and indeed general use of assemblies in Unity, see this excellent article in the Unity documentation: <a href="http://docs.unity3d.com/Documentation/Manual/UsingDLL.html">Using Mono DLLs in a Unity Project</a></p>
<p>And that is all, folks. I hope you find it useful!</p></div>
				</div>
				<div id="feed-container">
					<div id="feed">
						
							<a href="/2014/06/20/Co-very-routine/" class="titleSmall">Co-very-routine</a><br />
						
							<a href="/2014/04/25/Construct/" class="titleSmall">Construct</a><br />
						
							<a href="/2014/03/25/The-Engine-Wars-Numbers/" class="titleSmall">The Engine Wars: Numbers</a><br />
						
							<a href="/2014/03/13/GDC-14-The-Quest-For-Fun/" class="titleSmall">GDC 14: The Quest For Fun</a><br />
						
							<a href="/2014/03/07/Moving-in-Unity/" class="titleSmall">Moving in Unity</a><br />
						
							<a href="/2014/02/27/Behave-2-3/" class="titleSmall">Behave 2.3</a><br />
						
							<a href="/2014/01/03/Unity-and-net-assemblies/" class="titleSmall">Unity and .net assemblies</a><br />
						
							<a href="/2013/12/23/Behave-2-2/" class="titleSmall">Behave 2.2</a><br />
						
							<a href="/2013/10/11/ReView/" class="titleSmall">ReView</a><br />
						
							<a href="/2013/10/06/Behave-2-1/" class="titleSmall">Behave 2.1</a><br />
						
							<a href="/2013/08/25/Behave-2-0/" class="titleSmall">Behave 2.0</a><br />
						
							<a href="/2013/08/04/Unity-Hacks-Dual-sticks/" class="titleSmall">Unity Hacks: Dual sticks</a><br />
						
							<a href="/2013/07/28/Unity-Hacks-Cameras/" class="titleSmall">Unity Hacks: Cameras</a><br />
						
							<a href="/2013/07/19/Unity-Hacks-Touch-gestures/" class="titleSmall">Unity Hacks: Touch gestures</a><br />
						
							<a href="/2013/07/17/OnRenderTextureGUI/" class="titleSmall">OnRenderTextureGUI</a><br />
						
							<a href="/2013/07/05/Unite-13-video-Unity-Hacks-available/" class="titleSmall">Unite 13 video "Unity Hacks" available</a><br />
						
							<a href="/2013/06/07/The-implicit-local-network-interface/" class="titleSmall">The implicit local network interface</a><br />
						
							<a href="/2013/05/21/Talks-and-progress/" class="titleSmall">Talks and progress</a><br />
						
							<a href="/2013/05/14/Five-years-of-Unity-expertise-looking-for-contracts/" class="titleSmall">Five years of Unity expertise looking for contracts</a><br />
						
							<a href="/2012/12/22/Automagic-Unity-Android-Java-gadget-OF-DOOM/" class="titleSmall">Automagic Unity Android Java gadget OF DOOM!</a><br />
						
							<a href="/2012/10/03/Invading-Planet-from-your-couch/" class="titleSmall">Invading Planet from your couch</a><br />
						
							<a href="/2012/09/28/Mountain-Lion-and-laggy-bluetooth-and-duct-tape/" class="titleSmall">Mountain Lion and laggy bluetooth and duct-tape</a><br />
						
							<a href="/2012/09/23/Unite-12-video-and-new-videos-section-available/" class="titleSmall">Unite 12 video and new videos section available</a><br />
						
							<a href="/2012/08/28/Asia-Bootcamp-videos-now-available/" class="titleSmall">Asia Bootcamp videos now available</a><br />
						
							<a href="/2012/05/17/path-is-now-mit-licensed/" class="titleSmall">Path is now MIT licensed</a><br />
						
							<a href="/2011/11/30/behave-1-4-released/" class="titleSmall">Behave 1.4 released</a><br />
						
							<a href="/2011/10/09/so-ive-been-a-bit-busy-lately/" class="titleSmall">So I've been a bit busy lately</a><br />
						
							<a href="/2011/04/28/behave-1-3-released/" class="titleSmall">Behave 1.3 released</a><br />
						
							<a href="/2011/04/23/igda-unity-sig-slides/" class="titleSmall">IGDA Unity SIG slides</a><br />
						
							<a href="/2011/03/17/second-unity-igda-sig-this-evening-scene-construction-and-ai/" class="titleSmall">Second Unity IGDA SIG this evening: Scene construction and AI</a><br />
						
							<a href="/2011/03/10/first-igda-unity-sig-this-evening/" class="titleSmall">First IGDA Unity SIG this evening</a><br />
						
							<a href="/2011/03/03/alternative-licensing-available/" class="titleSmall">Alternative licensing available</a><br />
						
							<a href="/2011/02/15/pathfinding-in-two-line/" class="titleSmall">Pathfinding in two lines</a><br />
						
							<a href="/2011/02/15/path-2-released/" class="titleSmall">Path 2 released</a><br />
						
							<a href="/2011/02/02/assembling-and-assimilating/" class="titleSmall">Assembling and assimilating</a><br />
						
							<a href="/2011/01/29/path-2-intro-screencast/" class="titleSmall">Path 2 intro screencast</a><br />
						
							<a href="/2011/01/29/path-2-beta-release-for-ggj/" class="titleSmall">Path 2 beta release for GGJ</a><br />
						
							<a href="/2011/01/25/aigamedev-master-class-video-now-online-3/" class="titleSmall">AIgameDev master class video now online</a><br />
						
							<a href="/2011/01/09/expanding-beta/" class="titleSmall">Expanding beta</a><br />
						
							<a href="/2010/11/28/behave-aigamedev-master-class-public-stream/" class="titleSmall">Behave AIgameDev master class public stream</a><br />
						
							<a href="/2010/11/27/behave-master-class-on-open-aigamedev-stream-tomorrow/" class="titleSmall">Behave master class on open AIgameDev stream tomorrow</a><br />
						
							<a href="/2010/10/29/interview-with-aigamedev/" class="titleSmall">Interview with AIGameDev</a><br />
						
							<a href="/2010/10/24/new-video-from-tree-to-code/" class="titleSmall">New video: From tree to code</a><br />
						
							<a href="/2010/10/23/issue-tracking-on-github-behave-release-project/" class="titleSmall">Issue tracking on github Behave release project</a><br />
						
							<a href="/2010/10/22/it-university-copenhagen-unity-course-completed/" class="titleSmall">IT University Copenhagen Unity course completed</a><br />
						
							<a href="/2010/10/21/it-university-copenhagen-unity-course-files-thursday/" class="titleSmall">IT University Copenhagen Unity course files Thursday</a><br />
						
							<a href="/2010/10/20/cph-it-university-unity-course-files/" class="titleSmall">CPH IT University Unity course files</a><br />
						
							<a href="/2010/10/11/behave-1-2-released/" class="titleSmall">Behave 1.2 released</a><br />
						
							<a href="/2010/09/29/video-behave-starting-from-scratch/" class="titleSmall">Video: Behave - starting from scratch</a><br />
						
							<a href="/2010/09/29/behave-runtime-documentation-updated/" class="titleSmall">Behave runtime documentation updated</a><br />
						
							<a href="/2010/09/29/behave-1-1-released/" class="titleSmall">Behave 1.1 released</a><br />
						
							<a href="/2010/03/19/faff-cleanup-sketch/" class="titleSmall">FAFF cleanup: Sketch</a><br />
						
							<a href="/2010/03/15/building-a-menu-of-delegates-and-enums/" class="titleSmall">Building a menu of delegates and enums</a><br />
						
							<a href="/2010/03/10/pick-me-pick-me/" class="titleSmall">Pick me! Pick me!</a><br />
						
							<a href="/2010/01/14/optimising-coroutine-yielding-in-c/" class="titleSmall">Optimising coroutine yielding in C#</a><br />
						
							<a href="/2010/01/05/downloading-the-hydra/" class="titleSmall">Downloading the hydra</a><br />
						
							<a href="/2009/11/15/new-license-of-path-gpl/" class="titleSmall">New license of Path: GPL</a><br />
						
							<a href="/2009/11/04/copyinspector/" class="titleSmall">CopyInspector</a><br />
						
							<a href="/2009/10/04/magnetic/" class="titleSmall">Magnetic</a><br />
						
							<a href="/2009/09/18/gui-drag-drop/" class="titleSmall">GUI drag-drop</a><br />
						
							<a href="/2009/09/17/logging-an-entire-gameobject/" class="titleSmall">Logging an entire GameObject</a><br />
						
							<a href="/2009/09/07/i-bet-you-cant-type-an-a/" class="titleSmall">I bet you can't type an A!</a><br />
						
							<a href="/2009/08/31/where-did-that-component-go/" class="titleSmall">Where did that component go?</a><br />
						
							<a href="/2009/08/19/unitysteer/" class="titleSmall">UnitySteer</a><br />
						
							<a href="/2009/05/18/new-and-improved-behave-10-released/" class="titleSmall">New and improved: Behave 1.0 released</a><br />
						
							<a href="/2009/04/08/behave-03b-and-unity-25/" class="titleSmall">Behave 0.3b and unity 2.5</a><br />
						
							<a href="/2009/03/20/behave-03b-hotfix/" class="titleSmall">Behave 0.3b hotfix</a><br />
						
							<a href="/2009/03/19/path-tutorial-video-available/" class="titleSmall">Path tutorial video available</a><br />
						
							<a href="/2009/03/18/path-10-launched/" class="titleSmall">Path 1.0 launched!</a><br />
						
							<a href="/2008/12/17/community-tutorial-2/" class="titleSmall">Continued community tutorials</a><br />
						
							<a href="/2008/11/30/community-tutorial/" class="titleSmall">Community tutorial</a><br />
						
							<a href="/2008/11/28/new-tutorial/" class="titleSmall">New tutorial</a><br />
						
							<a href="/2008/11/04/first-tutorial-available/" class="titleSmall">First tutorial available</a><br />
						
							<a href="/2008/11/02/behave-03b/" class="titleSmall">Behave 0.3b</a><br />
						
							<a href="/2008/10/25/unite-08-open-mic-session/" class="titleSmall">unite '08 open-mic session</a><br />
						
							<a href="/2008/09/24/behave-02b/" class="titleSmall">Behave 0.2b</a><br />
						
							<a href="/2008/09/09/behave-01b/" class="titleSmall">Behave 0.1b</a><br />
						
							<a href="/2008/09/08/behave-pre-release/" class="titleSmall">Behave pre-release</a><br />
						
							<a href="/2008/04/15/path-beta-03b/" class="titleSmall">Path beta 0.3b</a><br />
						
							<a href="/2008/04/12/path-beta-02b/" class="titleSmall">Path beta 0.2b</a><br />
						
							<a href="/2008/04/05/path-beta-01b/" class="titleSmall">Path beta 0.1b</a><br />
						
							<a href="/2008/03/30/path-pre-release/" class="titleSmall">Path pre-release</a><br />
						
					</div>
				</div>
				<div id="footer">
	<p class="footnote" style="margin-top: 50px; margin-bottom: 10px; clear: both;">Copyright &#169; AngryAnt&trade; <script>document.write ((new Date ()).getFullYear ());</script>. All public github gists are public domain.</p>
	<script>document.write ('<img src="/resources/footers/' + Math.floor (Math.random () * 23 + 1) + '.png" width="600" height="300" class="noprint" style="margin-bottom: -5px;">');</script>
</div>

			</div>
		</div>
		

	</body>
</html>
