<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
	<head>
		<title>AngryAnt - Downloading the hydra - </title>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="/css/screen/base.css" type="text/css" media="screen" />
<link rel="stylesheet" href="/css/screen/site.css" type="text/css" media="screen" />
<link rel="stylesheet" href="/css/print/base.css" type="text/css" media="print" />
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34029666-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


		<link rel="author" href="https://plus.google.com/+EmilJohansen" />
	</head>
	<body>
		<div id="site">
			<div id="sidebar">
				<img id="logo" title="Logo" alt="Logo" src="/resources/logo.png">
<h1 class="header"><a href="/" style="padding:0; margin:0; float: none;">AngryAnt</a></h1>
<div id="subtitle">Downloading the hydra</div>

	
		<a href="/">Home</a>
		
	

	
		<a href="/freelance">Freelance</a>
		
	

	
		<a href="/work">Work</a>
		
	

	
		<a href="/behave">Behave</a>
		
	

	
		<a href="/tools">Tools</a>
		
	

	
		<a href="/feed">Feed</a>
		
	

	
		<a href="/videos">Videos</a>
		
	


<div id="availability">
	<a href="/freelance">Next availability: <span id="available">April</span></a>
</div>
<div id="external">
	<a href="/feed.xml">RSS</a>
	<a href="/feed.articles.xml">Full RSS</a>
	<a href="https://gist.github.com/AngryAnt">Gist</a>
	<a href="https://twitter.com/AngryAnt">Twitter</a>
	<a href="http://www.linkedin.com/in/EmilJohansen">LinkedIn</a>
	<a href="http://lanyrd.com/profile/angryant/">Lanyrd</a>
</div>

			</div>
			<div id="container">
				<span class="date">05 Jan 2010</span>
				<h1 id="Top">Downloading the hydra</h1>
				
				<div id="content">
					<div class="post"><p>So I&#8217;ve seen some people asking how you would go about downloading executable code from an external location, reading it into memory and executing it in ones running application.</p>
<p>Now some readers might go &#8220;eh? why the heck would someone want to do that?&#8221;. Well first off, <b>its cool</b>&#8482;, but seeing as that is rarely an argument which convinces decision makers, here&#8217;s a few others:</p>
<ul>
	<li>Patching. The ability to modify the behaviour of your downloaded executable after distribution, without requiring re-download.</li>
	<li>Highly dynamic online content. Say you&#8217;re building a virtual world or something. You might want to have the ability to add more complex behaviours to downloaded content &#8211; more than what a data-driven approach allows for.</li>
	<li>Or how about expanding the capabilities of user generated content?</li>
</ul>
<p>There. Those are my alibis and I&#8217;m sticking to them.</p>
<p>Now this example is quick and simple so as to not bloat the post too much. Regardless of your use, you&#8217;ll likely be wanting to add in for instance some cache functionality for real-world use.</p>
<p>Right. So this example contains three pieces of eight, uh, code:</p>
<ul>
	<li>The loader utility &#8211; responsible for downloading and making available the remote code.</li>
	<li>The assembly &#8211; you know, the one we&#8217;re downloading.</li>
	<li>An example handler. For easy re-use, I&#8217;ve designed this example to allow for easy re-use of the loader utility by externalising handling of the assemblies via messages. This example handler shows some techniques for accessing the data of loaded assemblies.</li>
</ul>
<p>Using the example:</p>
<ol>
	<li>Download and save /Assets/WWWAssemblyLoader.cs, /Assets/NewBehaviourScript.cs and /MyAssembly.cs.</li>
	<li>Download and install the mono runtime (or the .net equivalent on Windnows &#8211; not tested, but should work just fine).</li>
	<li>Build the assembly from the terminal &#8211; using the build command supplied at the end of this post.</li>
	<li>Upload the assembly to some host (save the <span class="caps">URL</span> for later).</li>
	<li>Open up your Unity project.</li>
	<li>Add the WWWAssemblyLoader and NewBehaviourScript scripts to a GameObject and set the <span class="caps">URL</span> property of the first to that of your uploaded assembly.</li>
	<li>Press play.</li>
	<li>Profit!</li>
</ol>
<p>And now the codes!</p>
<p><b>/Assets/WWWAssemblyLoader.cs</b>
<script src='https://gist.github.com/3806151.js?file=WWWAssemblyLoader.cs'></script><div><noscript><pre><code>using UnityEngine;
using System.Collections;
using System.Reflection;</p>
<p>public class WWWAssemblyLoader : MonoBehaviour
{
	public string m_AssemblyURL;
	private string m_ErrorString = &quot;&quot;;
	private <span class="caps">WWW</span> m_WWW;
	private bool m_Complete = true;</p>
<p>public void Start ()
	{
		if (m_AssemblyURL != &quot;&quot;)
		{
			ReloadAssembly (m_AssemblyURL);
		}
	}</p>
<p>public string AssemblyURL
	{
		get
		{
			return m_AssemblyURL;
		}
		set
		{
			if (m_AssemblyURL != value)
			{
				ReloadAssembly (value);
			}
		}
	}</p>
<p>public float Progress
	{
		get
		{
			return m_Complete ? 1.0f : m_WWW.progress;
		}
	}</p>
<p>public string Error
	{
		get
		{
			return m_ErrorString;
		}
	}</p>
<p>public void ReloadAssembly (string url)
	{
		m_Complete = false;
		m_ErrorString = &quot;&quot;;
		m_AssemblyURL = url;
		m_WWW = new <span class="caps">WWW</span> (m_AssemblyURL);
	}</p>
<p>public void Update ()
	{
		if (!m_Complete)
		{
			if (m_WWW.error != null)
			{
				m_ErrorString = m_WWW.error;
				m_Complete = true;
				SendMessage (&quot;OnAssemblyLoadFailed&quot;, m_AssemblyURL);
			}
			else if (m_WWW.isDone)
			{
				Assembly assembly = LoadAssembly ();
				m_Complete = true;
				if (assembly != null)
				{
					Debug.Log (&quot;Done&quot;);
					SendMessage (&quot;OnAssemblyLoaded&quot;, new WWWAssembly (m_AssemblyURL, assembly));
				}
				else
				{
					Debug.Log (&quot;Failed&quot;);
					SendMessage (&quot;OnAssemblyLoadFailed&quot;, m_AssemblyURL);
				}
			}
		}
	}</p>
<p>private Assembly LoadAssembly ()
	{
		try
		{
			return Assembly.Load (m_WWW.bytes);
		}
		catch (System.Exception e)
		{
			m_ErrorString = e.ToString ();
			return null;
		}
	}
}</p>
<p>public class WWWAssembly
{
	private string m_URL;
	private Assembly m_Assembly;</p>
<p>public string <span class="caps">URL</span>
	{
		get
		{
			return m_URL;
		}
	}</p>
<p>public Assembly Assembly
	{
		get
		{
			return m_Assembly;
		}
	}</p>
<p>public WWWAssembly (string url, Assembly assembly)
	{
		m_URL = url;
		m_Assembly = assembly;
	}
}</code></pre></noscript></div></p>
<p><b>/Assets/NewBehaviourScript.cs</b>
<script src='https://gist.github.com/3806151.js?file=NewBehaviourScript.cs'></script><div><noscript><pre><code>using UnityEngine;
using System.Collections;
using System.Reflection;</p>
<p>public class NewBehaviourScript : MonoBehaviour
{
	private string m_MessageString = &quot;Waiting for assembly&quot;;</p>
<p>void OnAssemblyLoaded (WWWAssembly loadedAssembly)
	{
		m_MessageString = &quot;Assembly &quot; + loadedAssembly.<span class="caps">URL</span> + &quot;\n&quot;;</p>
<p>System.Type type = loadedAssembly.Assembly.GetType (&quot;MyClass&quot;);</p>
<p>FieldInfo field = type.GetField (&quot;myString&quot;);
		m_MessageString += (field.GetValue (null) as string) + &quot;\n&quot;;</p>
<p>object instance = loadedAssembly.Assembly.CreateInstance (&quot;MyClass&quot;);
		MethodInfo method = type.GetMethod (&quot;LogMyString&quot;);
		m_MessageString += &quot;Return value: &quot; + method.Invoke (instance, null).ToString ();
	}</p>
<p>void OnAssemblyLoadFailed (string url)
	{
		m_MessageString = &quot;Failed to load assembly at &quot; + url;
	}</p>
<p>void OnGUI ()
	{
		GUILayout.BeginArea (new Rect (0.0f, 0.0f, Screen.width, Screen.height));
			GUILayout.FlexibleSpace ();
			GUILayout.BeginHorizontal ();
				GUILayout.FlexibleSpace ();
				GUILayout.Box (m_MessageString);
				GUILayout.FlexibleSpace ();
			GUILayout.EndHorizontal ();
			GUILayout.FlexibleSpace ();
		GUILayout.EndArea ();
	}
}</code></pre></noscript></div></p>
<p><b>/MyAssembly.cs</b>
<script src='https://gist.github.com/3806151.js?file=MyAssembly.cs'></script><div><noscript><pre><code>using UnityEngine;</p>
<p>public class MyClass
{
	public static string myString = &quot;This is my string from my class in my assembly&quot;;</p>
<p>public int LogMyString ()
	{
		Debug.Log (myString);
		return 2 + 2;
	}
}</code></pre></noscript></div></p>
<p><b>The assembly compile terminal command</b>
<script src='https://gist.github.com/3806151.js?file=Build.sh'></script><div><noscript><pre><code>mcs -target:library -out:MyAssembly.dll -r:/Applications/Unity/Unity.app/Contents/Frameworks/UnityEngine.dll  MyAssembly.cs</code></pre></noscript></div></p></div>
				</div>
				<div id="feed">
					
						<a href="/2014/03/07/Moving-in-Unity/" class="titleSmall">Moving in Unity</a><br />
					
						<a href="/2014/02/27/Behave-2-3/" class="titleSmall">Behave 2.3</a><br />
					
						<a href="/2014/01/03/Unity-and-net-assemblies/" class="titleSmall">Unity and .net assemblies</a><br />
					
						<a href="/2013/12/23/Behave-2-2/" class="titleSmall">Behave 2.2</a><br />
					
						<a href="/2013/10/11/ReView/" class="titleSmall">ReView</a><br />
					
						<a href="/2013/10/06/Behave-2-1/" class="titleSmall">Behave 2.1</a><br />
					
						<a href="/2013/08/25/Behave-2-0/" class="titleSmall">Behave 2.0</a><br />
					
						<a href="/2013/08/04/Unity-Hacks-Dual-sticks/" class="titleSmall">Unity Hacks: Dual sticks</a><br />
					
						<a href="/2013/07/28/Unity-Hacks-Cameras/" class="titleSmall">Unity Hacks: Cameras</a><br />
					
						<a href="/2013/07/19/Unity-Hacks-Touch-gestures/" class="titleSmall">Unity Hacks: Touch gestures</a><br />
					
						<a href="/2013/07/17/OnRenderTextureGUI/" class="titleSmall">OnRenderTextureGUI</a><br />
					
						<a href="/2013/07/05/Unite-13-video-Unity-Hacks-available/" class="titleSmall">Unite 13 video "Unity Hacks" available</a><br />
					
						<a href="/2013/06/07/The-implicit-local-network-interface/" class="titleSmall">The implicit local network interface</a><br />
					
						<a href="/2013/05/21/Talks-and-progress/" class="titleSmall">Talks and progress</a><br />
					
						<a href="/2013/05/14/Five-years-of-Unity-expertise-looking-for-contracts/" class="titleSmall">Five years of Unity expertise looking for contracts</a><br />
					
						<a href="/2012/12/22/Automagic-Unity-Android-Java-gadget-OF-DOOM/" class="titleSmall">Automagic Unity Android Java gadget OF DOOM!</a><br />
					
						<a href="/2012/10/03/Invading-Planet-from-your-couch/" class="titleSmall">Invading Planet from your couch</a><br />
					
						<a href="/2012/09/28/Mountain-Lion-and-laggy-bluetooth-and-duct-tape/" class="titleSmall">Mountain Lion and laggy bluetooth and duct-tape</a><br />
					
						<a href="/2012/09/23/Unite-12-video-and-new-videos-section-available/" class="titleSmall">Unite 12 video and new videos section available</a><br />
					
						<a href="/2012/08/28/Asia-Bootcamp-videos-now-available/" class="titleSmall">Asia Bootcamp videos now available</a><br />
					
						<a href="/2012/05/17/path-is-now-mit-licensed/" class="titleSmall">Path is now MIT licensed</a><br />
					
						<a href="/2011/11/30/behave-1-4-released/" class="titleSmall">Behave 1.4 released</a><br />
					
						<a href="/2011/10/09/so-ive-been-a-bit-busy-lately/" class="titleSmall">So I've been a bit busy lately</a><br />
					
						<a href="/2011/04/28/behave-1-3-released/" class="titleSmall">Behave 1.3 released</a><br />
					
						<a href="/2011/04/23/igda-unity-sig-slides/" class="titleSmall">IGDA Unity SIG slides</a><br />
					
						<a href="/2011/03/17/second-unity-igda-sig-this-evening-scene-construction-and-ai/" class="titleSmall">Second Unity IGDA SIG this evening: Scene construction and AI</a><br />
					
						<a href="/2011/03/10/first-igda-unity-sig-this-evening/" class="titleSmall">First IGDA Unity SIG this evening</a><br />
					
						<a href="/2011/03/03/alternative-licensing-available/" class="titleSmall">Alternative licensing available</a><br />
					
						<a href="/2011/02/15/pathfinding-in-two-line/" class="titleSmall">Pathfinding in two lines</a><br />
					
						<a href="/2011/02/15/path-2-released/" class="titleSmall">Path 2 released</a><br />
					
						<a href="/2011/02/02/assembling-and-assimilating/" class="titleSmall">Assembling and assimilating</a><br />
					
						<a href="/2011/01/29/path-2-intro-screencast/" class="titleSmall">Path 2 intro screencast</a><br />
					
						<a href="/2011/01/29/path-2-beta-release-for-ggj/" class="titleSmall">Path 2 beta release for GGJ</a><br />
					
						<a href="/2011/01/25/aigamedev-master-class-video-now-online-3/" class="titleSmall">AIgameDev master class video now online</a><br />
					
						<a href="/2011/01/09/expanding-beta/" class="titleSmall">Expanding beta</a><br />
					
						<a href="/2010/11/28/behave-aigamedev-master-class-public-stream/" class="titleSmall">Behave AIgameDev master class public stream</a><br />
					
						<a href="/2010/11/27/behave-master-class-on-open-aigamedev-stream-tomorrow/" class="titleSmall">Behave master class on open AIgameDev stream tomorrow</a><br />
					
						<a href="/2010/10/29/interview-with-aigamedev/" class="titleSmall">Interview with AIGameDev</a><br />
					
						<a href="/2010/10/24/new-video-from-tree-to-code/" class="titleSmall">New video: From tree to code</a><br />
					
						<a href="/2010/10/23/issue-tracking-on-github-behave-release-project/" class="titleSmall">Issue tracking on github Behave release project</a><br />
					
						<a href="/2010/10/22/it-university-copenhagen-unity-course-completed/" class="titleSmall">IT University Copenhagen Unity course completed</a><br />
					
						<a href="/2010/10/21/it-university-copenhagen-unity-course-files-thursday/" class="titleSmall">IT University Copenhagen Unity course files Thursday</a><br />
					
						<a href="/2010/10/20/cph-it-university-unity-course-files/" class="titleSmall">CPH IT University Unity course files</a><br />
					
						<a href="/2010/10/11/behave-1-2-released/" class="titleSmall">Behave 1.2 released</a><br />
					
						<a href="/2010/09/29/video-behave-starting-from-scratch/" class="titleSmall">Video: Behave - starting from scratch</a><br />
					
						<a href="/2010/09/29/behave-runtime-documentation-updated/" class="titleSmall">Behave runtime documentation updated</a><br />
					
						<a href="/2010/09/29/behave-1-1-released/" class="titleSmall">Behave 1.1 released</a><br />
					
						<a href="/2010/03/19/faff-cleanup-sketch/" class="titleSmall">FAFF cleanup: Sketch</a><br />
					
						<a href="/2010/03/15/building-a-menu-of-delegates-and-enums/" class="titleSmall">Building a menu of delegates and enums</a><br />
					
						<a href="/2010/03/10/pick-me-pick-me/" class="titleSmall">Pick me! Pick me!</a><br />
					
						<a href="/2010/01/14/optimising-coroutine-yielding-in-c/" class="titleSmall">Optimising coroutine yielding in C#</a><br />
					
						<a href="/2010/01/05/downloading-the-hydra/" class="titleSmall">Downloading the hydra</a><br />
					
						<a href="/2009/11/15/new-license-of-path-gpl/" class="titleSmall">New license of Path: GPL</a><br />
					
						<a href="/2009/11/04/copyinspector/" class="titleSmall">CopyInspector</a><br />
					
						<a href="/2009/10/04/magnetic/" class="titleSmall">Magnetic</a><br />
					
						<a href="/2009/09/18/gui-drag-drop/" class="titleSmall">GUI drag-drop</a><br />
					
						<a href="/2009/09/17/logging-an-entire-gameobject/" class="titleSmall">Logging an entire GameObject</a><br />
					
						<a href="/2009/09/07/i-bet-you-cant-type-an-a/" class="titleSmall">I bet you can't type an A!</a><br />
					
						<a href="/2009/08/31/where-did-that-component-go/" class="titleSmall">Where did that component go?</a><br />
					
						<a href="/2009/08/19/unitysteer/" class="titleSmall">UnitySteer</a><br />
					
						<a href="/2009/05/18/new-and-improved-behave-10-released/" class="titleSmall">New and improved: Behave 1.0 released</a><br />
					
						<a href="/2009/04/08/behave-03b-and-unity-25/" class="titleSmall">Behave 0.3b and unity 2.5</a><br />
					
						<a href="/2009/03/20/behave-03b-hotfix/" class="titleSmall">Behave 0.3b hotfix</a><br />
					
						<a href="/2009/03/19/path-tutorial-video-available/" class="titleSmall">Path tutorial video available</a><br />
					
						<a href="/2009/03/18/path-10-launched/" class="titleSmall">Path 1.0 launched!</a><br />
					
						<a href="/2008/12/17/community-tutorial-2/" class="titleSmall">Continued community tutorials</a><br />
					
						<a href="/2008/11/30/community-tutorial/" class="titleSmall">Community tutorial</a><br />
					
						<a href="/2008/11/28/new-tutorial/" class="titleSmall">New tutorial</a><br />
					
						<a href="/2008/11/04/first-tutorial-available/" class="titleSmall">First tutorial available</a><br />
					
						<a href="/2008/11/02/behave-03b/" class="titleSmall">Behave 0.3b</a><br />
					
						<a href="/2008/10/25/unite-08-open-mic-session/" class="titleSmall">unite '08 open-mic session</a><br />
					
						<a href="/2008/09/24/behave-02b/" class="titleSmall">Behave 0.2b</a><br />
					
						<a href="/2008/09/09/behave-01b/" class="titleSmall">Behave 0.1b</a><br />
					
						<a href="/2008/09/08/behave-pre-release/" class="titleSmall">Behave pre-release</a><br />
					
						<a href="/2008/04/15/path-beta-03b/" class="titleSmall">Path beta 0.3b</a><br />
					
						<a href="/2008/04/12/path-beta-02b/" class="titleSmall">Path beta 0.2b</a><br />
					
						<a href="/2008/04/05/path-beta-01b/" class="titleSmall">Path beta 0.1b</a><br />
					
						<a href="/2008/03/30/path-pre-release/" class="titleSmall">Path pre-release</a><br />
					
				</div>
				<div id="footer">
	<p class="footnote" style="margin-top: 50px; margin-bottom: 10px; clear: both;">Copyright &#169; AngryAnt&trade; <script>document.write ((new Date ()).getFullYear ());</script>. All public github gists are public domain.</p>
	<script>document.write ('<img src="/resources/footers/' + Math.floor (Math.random () * 23 + 1) + '.png" width="600" height="300" class="noprint" style="margin-bottom: -5px;">');</script>
</div>

			</div>
		</div>
		

	</body>
</html>
